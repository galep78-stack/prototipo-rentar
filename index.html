// 3. Manejo de cambios de estado (cuando el usuario inicia o cierra sesión)
supabaseClient.auth.onAuthStateChange((event, session) => {
    currentUser = session ? session.user : null;
    renderHeader(); 
    
    if (currentUser) {
        // Si el evento es un inicio de sesión explícito...
        if (event === 'SIGNED_IN') { 
            goToDashboard();
        }
        // Para otros eventos (como 'TOKEN_REFRESHED'...)
        // no hacemos nada...
    } else if (event === 'SIGNED_OUT') {
        // Si el evento es LOGOUT, ir a Home
        setView('home'); 
    }
});
